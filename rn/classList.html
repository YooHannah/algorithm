<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
</head>
<body>
  <div id="my-div" class="classA classB"></div>
  <script>
    var div = window["my-div"]
    var cl = div.classList
    function NeDOMTokenList(classes,dom){
      [].push.apply(this,classes)
      var value = classes.join(' ')
      Object.defineProperty(this,"value",{ //跟踪value变化，更新DOM节点标签值
        set:function(nvalue){
          dom.className = value = nvalue
        },
        get:function(){
          return value
        }
      })
    }
    NeDOMTokenList.prototype = Object.create(
      Array.prototype,{ //Array.prototype将{}转成[],构造伪数组,把数组方法继承过来
        constructor:{
          value:NeDOMTokenList
        },
        add:{
          value:function add(oneclass){
            if(this.contains(oneclass)) return
            this.push(oneclass)
            this.value = this.join(" ")
          }
        },
        remove:{
          value:function remove(oneclass){
            var index = this.findIndex(item=>{return item === oneclass})
            if(index>-1){
              this.splice(index,1)
              this.value = this.join(' ')
              return oneclass
            }else{
              console.error('there is no class:'+ oneclass)
            }
          }
        },
        contains:{
          value:function contains(oneclass){
            return this.includes(oneclass)
          }
        },
        toggle:{
          value:function toggle(oneclass){
            this.contains(oneclass)?this.remove(oneclass):this.add(oneclass)
          }
        },
      }
    )
    //1.如何让所有的DOM元素都拥有一个属性叫做neClassList
    //2.让NeDOMTokenList成为类数组
    Object.defineProperty(HTMLElement.prototype,"neClassList",{
      get:function(){
        if(!this.__dtl__){
          var classes = this.className.split(" ")
          this.__dtl__ = new NeDOMTokenList(classes,this)
        }
        return this.__dtl__
      }
    })//设置一个对象属性钩子

   
    div.neClassList.add("classC")
    console.log(div.classList)
    console.log(div.neClassList)
    // div.neClassList.remove("classD")
    // div.neClassList.toggle("classC")
    // window.setTimeout(function(){
    //   div.neClassList.toggle("classC")
    // },2000)
  </script>
</body>
</html>